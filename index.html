<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Testing</title>
</head>
<body>
  <script type="text/javascript" src="/bower_components/jquery/jquery.js"></script>
  <script type="text/javascript" src="/bower_components/handlebars/handlebars.js"></script>
  <script type="text/javascript" src="/bower_components/ember/ember.js"></script>

  <!-- TODO - remove once ember-inflector is available via bower -->
  <script type="text/javascript" src="tests/ember-inflector.js"></script>
  <script type="text/javascript" src="dist/fireplace.js"></script>

  <script type="text/javascript">
    TESTING = true;
  </script>

  <script src='https://cdn.firebase.com/v0/firebase.js'></script>

  <script>
    var App = Ember.Application.create();

    var attr = FP.attr, one = FP.hasOne, many = FP.hasMany;

    FP.Store.reopen({
      firebaseRoot: "https://fireplace-dev.firebaseio.com"
    })

    App.Avatar = FP.Model.extend({
      image: attr()
    })

    App.Address = FP.Model.extend({
      street: attr()
    })

    App.Person = FP.Model.extend({
      name:      attr(),
      avatar:    one("avatar"),
      addresses: many("address"),
      thing:     one("thing", {detached: true}),
      tasks:     many("task", {detached: true, path: "tasks/assigned-to/%@", collection: "indexed"})
    });

    App.Thing = FP.Model.extend({
      name: attr()
    });

    App.Task = FP.Model.extend({
      title: attr()
    });

    App.IndexRoute = Ember.Route.extend({
      model: function() {
        // return this.store.fetchQuery("person", {path: "indexed-people", collection: "indexed"});
        return this.store.fetch("person");
      }
    });

    App.IndexController = Ember.ArrayController.extend();
  </script>

  <script type="text/x-handlebars" data-template-name="index">
    PEOPLE ({{length}})
    <ul>
      {{#each person in controller}}
        <li>
          {{person.name}} - {{person.avatar.image}} - {{person.thing.name}} <br />

          ADDRESSES ({{person.addresses.length}})
          <ul>
            {{#each address in person.addresses}}
              <li>{{address.street}}</li>
            {{/each}}
          </ul>

          TASKS ({{person.tasks.length}})
          <ul>
            {{#each task in person.tasks}}
              <li>{{task.title}}</li>
            {{/each}}
          </ul>
        </li>
      {{/each}}
    </ul>
  </script>

  <script type="text/x-handlebars" data-template-name="index-foo">
    {{log content.firebaseReference}}
    TASKS ({{length}})
    <ul>
      {{#each task in controller}}
        <li>
          {{task.title}}
        </li>
      {{/each}}
    </ul>
  </script>

</body>
</html>